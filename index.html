<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Лесные Проказники — интерактивные сказки для детей">
    <meta name="theme-color" content="#2e7d32">
    <!-- Мета-теги для iOS, чтобы убрать интерфейс браузера -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Лесные Проказники - Интерактивные Сказки</title>
    <!-- Подключаем шрифт Nunito через Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <!-- Подключаем manifest.json для PWA -->
    <link rel="manifest" href="/manifest.json">
    <!-- Favicon для браузера -->
    <link rel="icon" href="/assets/icons/icon-192x192.png" type="image/png">
    <!-- Стили для уведомления об установке и переключателя темы -->
    <style>
        .install-prompt {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2e7d32;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            text-align: center;
            max-width: 300px;
            z-index: 1000;
        }
        .install-prompt button {
            background-color: #f0f4e8;
            color: #2e7d32;
            border: none;
            padding: 8px 16px;
            margin: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
        }
        .install-prompt button:hover {
            background-color: #d4e0c2;
        }
        /* Стили для переключателя темы */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .theme-toggle label {
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            color: #333;
        }
        body.dark-theme .theme-toggle label {
            color: #e0e0e0;
        }
        .theme-toggle input[type="checkbox"] {
            appearance: none;
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            outline: none;
        }
        .theme-toggle input[type="checkbox"]::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
        }
        .theme-toggle input[type="checkbox"]:checked {
            background-color: #2e7d32;
        }
        body.dark-theme .theme-toggle input[type="checkbox"]:checked {
            background-color: #4caf50;
        }
        .theme-toggle input[type="checkbox"]:checked::before {
            transform: translateX(20px);
        }
    </style>
    <!-- Firebase SDK для аналитики (подключаем как модуль) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAnalytics, logEvent } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js';
        import { firebaseConfig } from '/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            logEvent(analytics, 'page_view', {
                page_title: 'Home Page',
                page_location: window.location.href
            });
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Failed to initialize Firebase:', error);
        }
    </script>
</head>
<body class="start-page">
    <div class="container">
        <header class="header">
            <h1>Лесные Проказники</h1>
            <!-- Переключатель темы (чекбокс) -->
            <div class="theme-toggle">
                <label for="themeSwitch">Тёмная тема</label>
                <input type="checkbox" id="themeSwitch">
            </div>
        </header>
        
        <div class="book-info">
            <img src="/assets/images/obloz.jpg" alt="Обложка книги" class="cover-image">
            
            <div class="action-buttons">
                <button class="start-button" onclick="window.location.href='/toc.html'">Начать Читать</button>
                <button class="support-button" onclick="window.open('https://donate.stream/yoomoney4100118537888423', '_blank')">Поддержать Проект</button>
            </div>
            
            <div class="description">
                <p>Добро пожаловать в волшебный лес, где каждый день превращается в новое приключение!</p>
                <p>В этой книге собраны добрые и весёлые истории о двух братьях — Артёме-Волке и Дане-Лисёнке, которые, как и все дети, любят исследовать мир, придумывать игры и иногда попадать в забавные передряги. Артём — рассудительный, смелый и заботливый, а Даня — неугомонный, хитрый и невероятно любопытный. Вместе они учатся дружбе, ответственности и тому, как важно заботиться о природе и друг о друге.</p>
                <p>Каждый рассказ — это отдельное приключение, полное тёплого юмора, неожиданных поворотов и важных детских открытий. Истории написаны с любовью к детям и основаны на реальных характерах двух маленьких братьев — моих сыновей, которые вдохновили меня на создание этого сборника.</p>
                <p>Прыгайте в путешествие вместе с Волком и Лисёнком — впереди столько тайн, смеха и новых знаний!</p>
                
                <p><strong>В этой книге:</strong></p>
                <ul>
                    <li>Увлекательные истории о лесных друзьях</li>
                    <li>Красочные иллюстрации</li>
                    <li>Озвучка каждой части истории</li>
                    <li>Удобное чтение на любом устройстве</li>
                </ul>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p>© 2025 Лесные Проказники. Все права защищены.</p>
    </footer>
    <!-- Уведомление об установке -->
    <div class="install-prompt" id="installPrompt">
        <p>Добавьте "Лесные Проказники" на главный экран!</p>
        <button onclick="installApp()">Установить</button>
        <button onclick="dismissPrompt()">Позже</button>
    </div>
    <!-- Регистрация Service Worker и логика переключения темы -->
    <script>
        // Регистрация Service Worker (закомментировано для локального тестирования)
        // if ('serviceWorker' in navigator) {
        //     window.addEventListener('load', () => {
        //         navigator.serviceWorker.register('/sw.js')
        //             .then(registration => console.log('Service Worker registered:', registration))
        //             .catch(error => console.error('Service Worker registration failed:', error));
        //     });
        // }

        // Логика уведомления об установке
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
        });

        window.installApp = function() {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('Пользователь установил приложение');
                } else {
                    console.log('Пользователь отказался от установки');
                }
                deferredPrompt = null;
                installPrompt.style.display = 'none';
            });
        };

        window.dismissPrompt = function() {
            installPrompt.style.display = 'none';
        };

        window.addEventListener('appinstalled', () => {
            installPrompt.style.display = 'none';
            console.log('Приложение было установлено');
        });

        // Логика переключения темы
        const themeSwitch = document.getElementById('themeSwitch');
        const body = document.body;

        // Проверяем сохранённую тему при загрузке страницы
        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-theme');
            themeSwitch.checked = true;
        }

        // Переключаем тему при клике
        themeSwitch.addEventListener('change', () => {
            if (themeSwitch.checked) {
                body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.remove('dark-theme');
                localStorage.setItem('theme', 'light');
            }
        });
    </script>
</body>
</html>